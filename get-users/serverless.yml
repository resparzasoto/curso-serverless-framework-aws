service: crud-serverless-users

frameworkVersion: "3"

plugins:
  - serverless-dynamodb-local
  - serverless-offline

provider:
  name: aws
  runtime: nodejs16.x
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - dynamodb:Query
            - dynamodb:Scan
            - dynamodb:GetItem
            - dynamodb:PutItem
            - dynamodb:UpdateItem
            - dynamodb:DeleteItem
          Resource: "arn:aws:dynamodb:${aws:region}:*:table/Users"

custom:
  dynamodb:
    stages:
      - dev
    start:
      docker: true
      port: 8000
      inMemory: true
      migrate: true
      seed: true
      noStart: true
    migration:
      dir: offline/migrations
    seed:
      initial:
        sources:
          - table: Users
            sources: [./dynamodb/offline/seeds/users.json]

package:
  patterns:
    - "dist/**/*.js"
    - "!dist/**/*.js.map"
    - "!src/**"
    - "!dynamodb/**"
    - "!serverless.yml"
    - "!tsconfig.json"
    - "!package.json"
    - "!package-lock.json"
  individually: true

functions:
  get-users:
    handler: dist/handler.getUsers
    name: get-users
    description: Hello world function with typescript
    memorySize: 128
    runtime: nodejs16.x
    timeout: 10
    events:
      - http:
          path: users
          method: GET

resources:
  Resources:
    UsersDynamoDBTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: Users
        BillingMode: PAY_PER_REQUEST
        AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        KeySchema:
        - AttributeName: id
          KeyType: HASH
        SSESpecification:
          SSEEnabled: true
